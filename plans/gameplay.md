# Gameplay Plan (Draft)

## Problem framing

Goal: teach polar coordinates to younger players through a treasure-finding loop that feels like operating a crane from a top-down view. The core interaction is clicking a polar location and watching the crane arm extend (r) and rotate (theta).

Constraints:

- Mobile-first touch input (forgiving hitboxes).
- Keep the math in radians and in ring units (see docs/polar-coordinates.md).
- Start simple: single scene, no networking, no external services.

Non-goals (for now):

- Procedural terrain, physics-heavy interactions, or long narrative sequences.

## Current app context

- The polar grid is drawn in Phaser Graphics on a white background.
- The grid uses 5 rings with numeric labels and 45-degree spokes.
- The crane arm is a dynamic steel beam sprite that scales in r then rotates CCW to theta.
- Excavations store angle (radians), radius (ring units), and radiusRatio.

## Implementation notes (current build)

- MainScene draws a flat white background via bgGradient.fillStyle(0xffffff).
- Grid is drawn with Graphics: 5 rings, each with its own color (currently #4a6b8a, #5d88a8, #74a1c2, #8db7d6, #a5cce6).
- Ring numbers are Text objects placed along the +x axis; gridLabels are destroyed and recreated on resize.
- Spokes are only at 45-degree angles plus the main axes; axis color is 0x1f2b33.
- The playable grid is left of the sidebar; panel width is ~25% of screen, and maxRadius is computed from width/height.
- pickCell uses dy = origin.y - pointer.worldY so theta increases CCW; theta is normalized to [0, 2*pi).
- animateCraneArm uses the steel_arm sprite, starts at r = 1 ring and theta = 0, then scales in X and rotates to -theta (negative to preserve CCW in screen space).
- Dig marks are ellipse sizes tied to radialStep; targetMarker uses light blue/white strokes.
- Sidebar list shows r in ring units and theta in radians (3 decimals).

Asset pipeline notes:
- steel-arm.png lives at public/assets/img/steel-arm.png with source at docs/images/steel-arm.aseprite.
- crane-arm.png still exists in public/assets/img but is unused.
- public/assets/manifest.json is generated by tools/gen-assets.ts on yarn build; update both when adding images or they get overwritten.
- snow_tiles spritesheet is still in the manifest but currently unused since the snow tilemap was removed.

## Core gameplay loop

1. The game generates N treasures along a polar path (golden spiral for now).
2. One treasure is marked as the current target; its exact polar coordinates are shown in the sidebar.
3. The player chooses a tool head (claw or magnet) and taps in the grid.
4. The crane arm animates: extend to r, then rotate CCW to theta.
5. If a treasure is in range:
   - Claw: collect treasure if close enough and unlocked.
   - Magnet: reveal nearby treasure locations and unlock them for the claw.
6. On treasure found, set the next target based on nearest remaining treasure.
7. Track unique treasures found across sessions.

## Coordinate system (must match implementation)

- Theta stored in radians in [0, 2\*pi).
- Radius stored in ring units [0, ringCount].
- radiusRatio = radius / ringCount.

Mapping from polar to screen is:

x = origin.x + r_px _ cos(theta)
y = origin.y - r_px _ sin(theta)

Refer to docs/polar-coordinates.md for full explanation and examples.

## Treasure generation (golden spiral)

We need a stable, resize-safe way to generate points along a spiral inside the 5-ring grid.

Proposed formula in normalized ring units:

- Use r = (exp(b _ t) - 1) / (exp(b _ tMax) - 1) \* ringCount
- b = ln(phi) / (pi / 2), phi = (1 + sqrt(5)) / 2
- t in [0, tMax], with tMax = 4\*pi (adjustable for density)

This gives r in [0, ringCount] regardless of screen size.

Point sampling:

- Generate 30 treasures by sampling t at equal steps or jittered steps.
- Use a seeded RNG for reproducibility (seed in config).
- Store each treasure with id, theta, radius, and state.

## Treasure state machine

States:

- Hidden: not visible to the player.
- Revealed: location shown (via magnet), but not collectible.
- Unlocked: collectible by claw.
- Collected: removed from the grid, added to player inventory.

Rules:

- Magnet can move Hidden -> Revealed and Revealed -> Unlocked.
- Claw can move Unlocked -> Collected.

## Tool heads

### Claw (primary)

- Small hitbox, must be near the treasure.
- Suggested hit radius: 0.20 ring units.
- Does not reveal; only collects unlocked treasures.

### Magnet (secondary)

- Larger hitbox (3x claw), reveals and unlocks.
- Suggested hit radius: 0.60 ring units.
- Moves along a cardioid path segment in the first quadrant.

Cardioid spec (open to revision):

- Base curve: r = a \* (1 - cos(t)), t in [0, pi/2]
- Align the curve to the user click angle by rotating the path.
- a should be set so the curve stays within ringCount.

"start from where the user clicks" mean the cardioid segment is
anchored at the click but then follows the patern of that section

## Crane arm animation

- Start at r = 1 ring, theta = 0.
- Expand in r to the target radius, then rotate CCW to theta.
- Rotation should ease in and accelerate toward the end.
- After completing the rotation, fade out and drop a dig mark.

## UI / UX

Right sidebar (always visible on mobile):

- Tool selector buttons (magnet, claw).
- Current target coordinates: r (rings), theta (radians).
- Inventory list of collected treasures with icons.
- Optional: toggle to show/hide grid spokes.

Input:

- Taps should be forgiving. If tap is outside the grid, ignore.
- Touch radius for selecting a treasure should be larger than the visual mark.

## Persistence

- Store list of collected treasure ids in local storage.
- Store current seed and progress index so a session is resumable.

## Audio / feedback

- Short click on tap.
- Distinct "found" sound on collection.
- Subtle pulse animation when magnet reveals or unlocks.

## Pixel MCP asset requests

All assets should be pixel-art with transparent backgrounds and crisp edges.
Palette should be wintery (cool blues / steel grays) with a single warm accent color.
Example palette: #1f2b33, #3e5666, #6e8fa3, #a5cce6, #dce6ed, #d94f3a.

### Tool icons (UI)

Size: 32x32 px. 1px outline. Minimal shading (2-3 tones).

- magnet_icon.png

  - A classic U-shaped magnet with a red tip and blue tip.
  - Diagonal orientation (tilt 20-30 deg) for energy.

- claw_icon.png
  - A digging truck scoop (front loader) facing right.
  - Keep details simple so it reads at 32px.

### Treasure sprites (world)

Size: 24x24 px (or 32x32 if needed). Each should read clearly at 1x scale.
Provide 10 items, winter / arctic themed:

1. Snowy owl feather
2. Narwhal tusk fragment
3. Aurora crystal shard
4. Inuit carving (small totem)
5. Arctic fox charm
6. Ice compass
7. Frosted locket
8. Polar bear paw print token
9. Shipwreck brass key
10. Glacial pearl

Optional: 2-frame idle bob (up/down by 1px) to make treasures feel alive.

### Effects

- reveal_pulse.png (16x16): circular pulse ring, 3-frame animation.
- unlock_sparkle.png (16x16): star burst, 3-frame animation.

### Crane arm (world)

- steel-arm.png already exists. If refined:
  - 120x12 px base with bolts every 12px.
  - Strong edge contrast so it reads on white.

## Risks and assumptions (skeptical review)

Assumptions to validate:

- Players understand radians once shown as decimal values.
- A 5-ring grid is enough space for 30 treasures without overlap.
- The golden spiral path does not cluster treasures too tightly near the center.
- Magnet rules are intuitive (reveal vs unlock vs collect).

Failure modes:

- If the spiral density is too high, treasures become indistinguishable.
- If hitboxes are too forgiving, the learning goal is lost.
- If too strict, mobile users get frustrated and churn.

Mitigations:

- Allow tuning hit radii via config.
- Use seeded generation with a "regenerate" button for testing.
- Provide a short tutorial card showing r/theta with a visual example.

## Milestones (implementation order)

1. Data model: treasure list, states, seed config.
2. UI: tool selector + target coordinate readout.
3. Magnet path + reveal logic.
4. Claw collect logic + inventory list.
5. Asset integration (icons, treasures, effects).
6. Polish: sounds, pulses, and micro-animations.
